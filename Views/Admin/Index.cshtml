@model IEnumerable<Timesheets_APP.ViewModels.TimesheetViewModel>

@{
    ViewData["Title"] = "Timesheets";
    Layout = "_Layout";
    var filterDate = (string)ViewData["FilterDate"] ?? "";
    var empIdFilter = ViewContext.HttpContext.Request.Query["empId"].FirstOrDefault() ?? "";
    var empNameFilter = ViewContext.HttpContext.Request.Query["empName"].FirstOrDefault() ?? "";
}

<h1>Timesheets</h1>

<ul class="nav nav-tabs mb-3">
    <li class="nav-item">
        <a class="nav-link active" href="#">Timesheets</a>
    </li>
    <li class="nav-item ml-auto">
        <form asp-controller="Account" asp-action="Logout" method="post">
            @Html.AntiForgeryToken()
            <button type="submit" class="btn btn-outline-danger btn-sm">Logout</button>
        </form>
    </li>
</ul>

<form method="get" class="form-row align-items-end mb-3">
    <div class="col-auto">
        <label for="datePicker" class="mb-0">Date</label>
        <input type="date" id="datePicker" name="date"
               class="form-control" value="@filterDate"
               style="width:20ch;" />
    </div>
    <div class="col-auto">
        <label for="empIdFilter" class="mb-0">Emp ID</label>
        <input type="text" id="empIdFilter" name="empId"
               class="form-control" value="@empIdFilter"
               style="width:10ch;" placeholder="e.g. 42" />
    </div>
    <div class="col-auto">
        <label for="empNameFilter" class="mb-0">Name</label>
        <input type="text" id="empNameFilter" name="empName"
               class="form-control" value="@empNameFilter"
               style="width:20ch;" placeholder="e.g. Smith" />
    </div>
    <div class="col-auto">
        <button type="submit" class="btn btn-primary">Filter</button>
        <a asp-action="Index" class="btn btn-secondary ml-2">Show All</a>
    </div>
</form>

<button class="btn btn-outline-primary mb-3" onclick="location.reload()">
    Refresh Timesheet List
</button>

<table class="table table-bordered">
    <thead>
        <tr>
            <th></th>
            <th>Employee ID</th>
            <th>Employee Name</th>
            <th>Timesheet Date</th>
            <th>Approved</th>
            <th>Last Modified</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var ts in Model)
        {
            <tr>
                <td>
                    <a asp-controller="Admin"
                       asp-action="ViewTimesheet"
                       asp-route-tsId="@ts.TsId"
                       class="btn btn-sm btn-link">
                        View Timesheet
                    </a>
                </td>
                <td>@ts.EmpId</td>
                <td>@ts.EmpName</td>
                <td>@ts.TsDate.ToString("yyyy-MM-dd")</td>
                <td>
                    @if (ts.Approved)
                    {
                        <span class="text-success font-weight-bold">Approved</span>
                    }
                    else
                    {
                        <span class="text-danger">Not Approved</span>
                    }
                </td>
                <td>@ts.Modified.ToString("yyyy-MM-dd HH:mm:ss")</td>
            </tr>
        }
    </tbody>
</table>
